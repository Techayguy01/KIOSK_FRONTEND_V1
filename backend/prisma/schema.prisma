generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                                               String            @id @default(uuid()) @db.Uuid
  hotel_name                                       String            @db.VarChar
  address                                          String?
  owner_user_id                                    String?           @db.Uuid
  plan_id                                          String?           @db.Uuid
  gstin                                            String?           @db.VarChar
  pan                                              String?           @db.VarChar
  createdAt                                        DateTime          @map("created_at") @db.Timestamptz(6)
  updatedAt                                        DateTime          @updatedAt @map("updated_at") @db.Timestamptz(6)
  image_url_1                                      String?
  image_url_2                                      String?
  image_url_3                                      String?
  slug                                             String            @unique @db.VarChar(100)
  bookings                                         Booking[]
  room_types                                       RoomType[]
  subscriptions                                    subscriptions[]
  support_tickets                                  support_tickets[]
  tenant_configs                                   tenant_configs?
  tenant_roles                                     tenant_roles[]
  tenant_users_tenant_users_tenant_idTotenants     tenant_users[]    @relation("tenant_users_tenant_idTotenants")
  tenant_users_tenants_owner_user_idTotenant_users tenant_users?     @relation("tenants_owner_user_idTotenant_users", fields: [owner_user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_tenants_owner_user_id")
  plans                                            plans?            @relation(fields: [plan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("tenants")
}

model alembic_version {
  version_num String @id(map: "alembic_version_pkc") @db.VarChar(32)
}

model permissions {
  id                        String                      @id @db.Uuid
  key                       String                      @unique @db.VarChar
  description               String?
  platform_role_permissions platform_role_permissions[]
  tenant_role_permissions   tenant_role_permissions[]
}

model plans {
  id            String          @id @db.Uuid
  name          String          @db.VarChar
  period_months Int?
  max_users     Int?
  max_roles     Int?
  max_rooms     Int?
  created_at    DateTime        @db.Timestamptz(6)
  price         Float           @default(0)
  is_archived   Boolean         @default(false)
  subscriptions subscriptions[]
  tenants       Tenant[]
}

model platform_role_permissions {
  role_id        String         @db.Uuid
  permission_id  String         @db.Uuid
  permissions    permissions    @relation(fields: [permission_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  platform_roles platform_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([role_id, permission_id])
}

model platform_roles {
  id                        String                      @id @db.Uuid
  name                      String                      @unique @db.VarChar
  status                    Boolean
  created_at                DateTime                    @db.Timestamp(6)
  platform_role_permissions platform_role_permissions[]
  platform_users            platform_users[]
}

model platform_users {
  id             String         @id @db.Uuid
  email          String         @unique @db.VarChar
  phone          String?        @db.VarChar
  name           String?        @db.VarChar
  password_hash  String
  role_id        String         @db.Uuid
  created_at     DateTime       @db.Timestamp(6)
  platform_roles platform_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model subscriptions {
  id         String    @id @db.Uuid
  tenant_id  String    @db.Uuid
  start_date DateTime  @db.Timestamp(6)
  end_date   DateTime? @db.Timestamp(6)
  status     String    @db.VarChar
  plan_id    String    @db.Uuid
  plans      plans     @relation(fields: [plan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenants    Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model support_tickets {
  id          String   @id @db.Uuid
  tenant_id   String   @db.Uuid
  title       String   @db.VarChar
  description String?
  category    String?  @db.VarChar
  priority    String   @db.VarChar
  status      String   @db.VarChar
  created_at  DateTime @db.Timestamptz(6)
  tenants     Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model tenant_role_permissions {
  role_id       String       @db.Uuid
  permission_id String       @db.Uuid
  permissions   permissions  @relation(fields: [permission_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenant_roles  tenant_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([role_id, permission_id])
}

model tenant_roles {
  id                      String                    @id @db.Uuid
  tenant_id               String                    @db.Uuid
  name                    String                    @db.VarChar
  status                  Boolean
  created_at              DateTime                  @db.Timestamptz(6)
  tenant_role_permissions tenant_role_permissions[]
  tenants                 Tenant                    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant_users            tenant_users[]
}

model tenant_users {
  id                                          String       @id @db.Uuid
  tenant_id                                   String       @db.Uuid
  email                                       String       @db.VarChar
  phone                                       String?      @db.VarChar
  name                                        String?      @db.VarChar
  password_hash                               String
  role_id                                     String       @db.Uuid
  created_at                                  DateTime     @db.Timestamptz(6)
  updated_at                                  DateTime     @db.Timestamptz(6)
  tenant_roles                                tenant_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenants_tenant_users_tenant_idTotenants     Tenant       @relation("tenant_users_tenant_idTotenants", fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants_tenants_owner_user_idTotenant_users Tenant[]     @relation("tenants_owner_user_idTotenant_users")
}

model RoomType {
  id         String    @id @default(uuid()) @db.Uuid
  tenant_id  String    @db.Uuid
  name       String    @db.VarChar(255)
  code       String    @db.VarChar(60)
  price      Decimal   @db.Decimal
  amenities  String[]  @default([]) @db.VarChar
  created_at DateTime  @db.Timestamptz(6)
  updated_at DateTime? @updatedAt @db.Timestamptz(6)
  bookings   Booking[]
  tenant     Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("room_types")
}

model Booking {
  id              String    @id @default(uuid()) @db.Uuid
  tenant_id       String    @db.Uuid
  room_type_id    String    @db.Uuid
  guest_name      String    @db.VarChar(255)
  check_in_date   DateTime  @db.Date
  check_out_date  DateTime  @db.Date
  adults          Int
  children        Int?
  nights          Int
  total_price     Decimal?  @db.Decimal
  status          String    @db.VarChar(20)
  idempotency_key String?   @db.VarChar(190)
  payment_ref     String?   @db.VarChar(120)
  created_at      DateTime  @db.Timestamptz(6)
  updated_at      DateTime? @updatedAt @db.Timestamptz(6)
  room_type       RoomType  @relation(fields: [room_type_id], references: [id], onUpdate: NoAction)
  tenant          Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("bookings")
}

model tenant_configs {
  id              String   @id @db.Uuid
  tenant_id       String   @unique @db.Uuid
  timezone        String   @db.VarChar(50)
  check_in_time   String   @db.VarChar(10)
  check_out_time  String   @db.VarChar(10)
  default_lang    String   @db.VarChar(10)
  welcome_message String?
  logo_url        String?
  support_phone   String?  @db.VarChar(20)
  support_email   String?  @db.VarChar(255)
  extra           Json     @default("{}")
  created_at      DateTime @db.Timestamptz(6)
  updated_at      DateTime @db.Timestamptz(6)
  tenants         Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

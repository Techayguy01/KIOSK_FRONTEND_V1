generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                                               String            @id @default(uuid()) @db.Uuid
  name                                             String            @map("hotel_name") @db.VarChar
  address                                          String?
  ownerUserId                                      String?           @map("owner_user_id") @db.Uuid
  planId                                           String?           @map("plan_id") @db.Uuid
  gstin                                            String?           @db.VarChar
  pan                                              String?           @db.VarChar
  createdAt                                        DateTime          @map("created_at") @db.Timestamptz(6)
  updatedAt                                        DateTime          @updatedAt @map("updated_at") @db.Timestamptz(6)
  imageUrl1                                        String?           @map("image_url_1")
  imageUrl2                                        String?           @map("image_url_2")
  imageUrl3                                        String?           @map("image_url_3")
  slug                                             String            @unique @db.VarChar(100)
  bookings                                         Booking[]
  roomTypes                                        RoomType[]
  subscriptions                                    subscriptions[]
  support_tickets                                  support_tickets[]
  hotelConfig                                      tenant_configs?
  tenant_roles                                     tenant_roles[]
  tenant_users_tenant_users_tenant_idTotenants     tenant_users[]    @relation("tenant_users_tenant_idTotenants")
  tenant_users_tenants_owner_user_idTotenant_users tenant_users?     @relation("tenants_owner_user_idTotenant_users", fields: [ownerUserId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_tenants_owner_user_id")
  plans                                            plans?            @relation(fields: [planId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("tenants")
}

model alembic_version {
  version_num String @id(map: "alembic_version_pkc") @db.VarChar(32)
}

model permissions {
  id                        String                      @id @db.Uuid
  key                       String                      @unique @db.VarChar
  description               String?
  platform_role_permissions platform_role_permissions[]
  tenant_role_permissions   tenant_role_permissions[]
}

model plans {
  id            String          @id @db.Uuid
  name          String          @db.VarChar
  period_months Int?
  max_users     Int?
  max_roles     Int?
  max_rooms     Int?
  created_at    DateTime        @db.Timestamptz(6)
  price         Float           @default(0)
  is_archived   Boolean         @default(false)
  subscriptions subscriptions[]
  tenants       Tenant[]
}

model platform_role_permissions {
  role_id        String         @db.Uuid
  permission_id  String         @db.Uuid
  permissions    permissions    @relation(fields: [permission_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  platform_roles platform_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([role_id, permission_id])
}

model platform_roles {
  id                        String                      @id @db.Uuid
  name                      String                      @unique @db.VarChar
  status                    Boolean
  created_at                DateTime                    @db.Timestamp(6)
  platform_role_permissions platform_role_permissions[]
  platform_users            platform_users[]
}

model platform_users {
  id             String         @id @db.Uuid
  email          String         @unique @db.VarChar
  phone          String?        @db.VarChar
  name           String?        @db.VarChar
  password_hash  String
  role_id        String         @db.Uuid
  created_at     DateTime       @db.Timestamp(6)
  platform_roles platform_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model subscriptions {
  id         String    @id @db.Uuid
  tenant_id  String    @db.Uuid
  start_date DateTime  @db.Timestamp(6)
  end_date   DateTime? @db.Timestamp(6)
  status     String    @db.VarChar
  plan_id    String    @db.Uuid
  plans      plans     @relation(fields: [plan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenants    Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model support_tickets {
  id          String   @id @db.Uuid
  tenant_id   String   @db.Uuid
  title       String   @db.VarChar
  description String?
  category    String?  @db.VarChar
  priority    String   @db.VarChar
  status      String   @db.VarChar
  created_at  DateTime @db.Timestamptz(6)
  tenants     Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model tenant_role_permissions {
  role_id       String       @db.Uuid
  permission_id String       @db.Uuid
  permissions   permissions  @relation(fields: [permission_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenant_roles  tenant_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([role_id, permission_id])
}

model tenant_roles {
  id                      String                    @id @db.Uuid
  tenant_id               String                    @db.Uuid
  name                    String                    @db.VarChar
  status                  Boolean
  created_at              DateTime                  @db.Timestamptz(6)
  tenant_role_permissions tenant_role_permissions[]
  tenants                 Tenant                    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant_users            tenant_users[]
}

model tenant_users {
  id                                          String       @id @db.Uuid
  tenant_id                                   String       @db.Uuid
  email                                       String       @db.VarChar
  phone                                       String?      @db.VarChar
  name                                        String?      @db.VarChar
  password_hash                               String
  role_id                                     String       @db.Uuid
  created_at                                  DateTime     @db.Timestamptz(6)
  updated_at                                  DateTime     @db.Timestamptz(6)
  tenant_roles                                tenant_roles @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tenants_tenant_users_tenant_idTotenants     Tenant       @relation("tenant_users_tenant_idTotenants", fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants_tenants_owner_user_idTotenant_users Tenant[]     @relation("tenants_owner_user_idTotenant_users")
}

model RoomType {
  id         String    @id @default(uuid()) @db.Uuid
  tenantId   String    @map("tenant_id") @db.Uuid
  name       String    @db.VarChar(255)
  code       String    @db.VarChar(60)
  price      Decimal   @db.Decimal
  amenities  String[]  @default([]) @db.VarChar
  createdAt  DateTime  @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)
  bookings   Booking[]
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("room_types")
}

model Booking {
  id              String    @id @default(uuid()) @db.Uuid
  tenantId        String    @map("tenant_id") @db.Uuid
  roomTypeId      String    @map("room_type_id") @db.Uuid
  guestName       String    @map("guest_name") @db.VarChar(255)
  checkInDate     DateTime  @map("check_in_date") @db.Date
  checkOutDate    DateTime  @map("check_out_date") @db.Date
  adults          Int
  children        Int?
  nights          Int
  totalPrice      Decimal?  @map("total_price") @db.Decimal
  status          String    @db.VarChar(20)
  idempotencyKey  String?   @map("idempotency_key") @db.VarChar(190)
  paymentRef      String?   @map("payment_ref") @db.VarChar(120)
  createdAt       DateTime  @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)
  roomType        RoomType  @relation(fields: [roomTypeId], references: [id], onUpdate: NoAction)
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("bookings")
}

model tenant_configs {
  id              String   @id @db.Uuid
  tenantId        String   @unique @map("tenant_id") @db.Uuid
  timezone        String   @db.VarChar(50)
  checkInTime     String   @map("check_in_time") @db.VarChar(10)
  checkOutTime    String   @map("check_out_time") @db.VarChar(10)
  defaultLang     String   @map("default_lang") @db.VarChar(10)
  welcomeMessage  String?  @map("welcome_message")
  logoUrl         String?  @map("logo_url")
  supportPhone    String?  @map("support_phone") @db.VarChar(20)
  supportEmail    String?  @map("support_email") @db.VarChar(255)
  extra           Json     @default("{}")
  createdAt       DateTime @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime @map("updated_at") @db.Timestamptz(6)
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}
